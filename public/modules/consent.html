<div id="consent">

<h2>Selection of Streaming Data</h2>

<p>
This is a web-based study of visualizations for streaming data. The study involves selecting a dot using various selection techniques. Participation will take approximately 45 minutes.
</p>

<p>
For each trial, you will click the 'GO' button and the data will start streaming. You will then click the red dot and once the dot is clicked you will be asked how many blue dots were on the screen.  The 'GO' button will appear again and you will repeat the task.
</p>

<p>
<strong>IMPORTANT: Once you begin, please do not use your browser's back button.</strong> It will not allow you to go back.
</p>

<p>
This study requires modern versions of <strong>Chrome</strong> or <strong>Firefox</strong> browsers. The application will <strong>not</strong> work correctly on Internet Explorer or Safari.
</p>

<p>
Participation is voluntary and no compensation will be given. You may stop at any time if you do not wish to continue. If you need more information about your rights as a study participant, you may contact: The Oak Ridge Site-Wide Institutional Review Board at 865-574-4359 or e-mail ORSIRB@orau.org. If you have other questions about this research, please contact Eric Ragan at raganed@ornl.gov.
</p>
<p>
If you agree to participate, please click the button to provide consent and continue with the study.
</p>

<button id="consentYes" type="button" class="start-button" disabled>I agree to participate</button>
<br>
<p>
<div id="validateMessage" class="validate"></div>
</p>

<br />

</div>

<style>
    #validateMessage {
        color: #FF5555;
    }
</style>

<script>
(function() {
  var data    = {}
    , workers = null;

  init();

  function init() {
    experimentr.hideNext();

    data.workerId = (+new Date()).toString(16) + "-" + Math.random().toString(16).replace("0.", "");

    var browser = get_browser_info();

    data.browserName = browser.name;
    data.browserVersion = browser.version;

    data.userDate = Date();

    // load previous workers file

    if (browser.name === "Firefox" || browser.name === "Chrome") {

        d3.json('modules/blocked-workers.json', function(err, d) {
          workers = d;
          validate();
        });

    } else {
        badBrowser();
    }
  }

  function validate() {
    if(data.workerId) {
      if( workers.indexOf(data.workerId) == -1 ) {
        d3.select('#consentYes').on('click', function() {
            experimentr.addData(data);
            experimentr.next();
        });
        d3.select('#consentYes').attr('disabled', null);
      } else {
        var messageThing = d3.select('#validateMessage');
        messageThing.html("Uh oh. Our records show that you already attempted this study, so we cannot allow you to participate again. If you think this is an error, try the link again, or you can contact " + contactPerson + " to ask for a new code.");
        d3.select('#consentYes').attr('disabled', 'disabled');
      }
    }
  }

  function badBrowser() {
    var messageThing = d3.select('#validateMessage');
    messageThing.html("Oops. You need to run this application in either a Chrome or Firefox browser. It will not work correctly in other browsers. Please copy the address into the address bar of Chrome or Firefox to participate in this study.");

    d3.select('#consentYes').attr('disabled', 'disabled');
  }

  function get_browser_info(){
    var ua=navigator.userAgent,tem,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];
    if(/trident/i.test(M[1])){
        tem=/\brv[ :]+(\d+)/g.exec(ua) || [];
        return 'IE '+(tem[1]||'');
        }
    if(M[1]==='Chrome'){
        tem=ua.match(/\bOPR\/(\d+)/)
        if(tem!=null)   {return 'Opera '+tem[1];}
        }
    M=M[2]? [M[1], M[2]]: [navigator.appName, navigator.appVersion, '-?'];
    if((tem=ua.match(/version\/(\d+)/i))!=null) {M.splice(1,1,tem[1]);}
    return {
      name: M[0],
      version: M[1]
    }
 }

}());


</script>
