<strong>Closing Questionnaire</strong>
<div id="closing">
  <br>
  <div>
    <h4>A ) For each technique, please rate the following on a scale of one(strongly disagree) to seven(strongly agree).</h4>
    <div id="q1">
      <div id="whol">

        <text id="wholLabel" fill="red"><strong> Whole Screen Freeze </strong></text>
        <div id="wholValidate" class="validate" style="font-size: 150%; left: 10px; float: left;"></div><br>
        <br>
        <text id="wholLabel1" fill="red">1. The technique was difficult to use:</text>
        <input type="text" class="textfield" value="" id="wholText1" size="3" maxlength="1" name="wholText1" onkeypress="return is1to7(event)" /><br>

        <text id="wholLabel2" fill="red">2. The technique was easy to understand:</text>
        <input type="text" class="textfield" value="" id="wholText2" size="3" maxlength="1" name="wholText2" onkeypress="return is1to7(event)" /><br>

        <text id="wholLabel3" fill="red">3. The technique was easy to use:</text>
        <input type="text" class="textfield" value="" id="wholText3" size="3" maxlength="1" name="wholText3" onkeypress="return is1to7(event)" /><br>

        <text id="wholLabel4" fill="red">4. The technique was confusing or difficult to understand:</text>
        <input type="text" class="textfield" value="" id="wholText4" size="3" maxlength="1" name="wholText4" onkeypress="return is1to7(event)" /><br>

        <text id="wholLabel5" fill="red">5. The technique made it difficult to select the target I wanted:</text>
        <input type="text" class="textfield" value="" id="wholText5" size="3" maxlength="1" name="wholText5" onkeypress="return is1to7(event)" /><br>

        <text id="wholLabel6" fill="red">6. The technique made it easy to select the target I wanted:</text>
        <input type="text" class="textfield" value="" id="wholText6" size="3" maxlength="1" name="wholText6" onkeypress="return is1to7(event)" /><br>

        <text id="wholLabel7" fill="red">7. I did not like the technique:</text>
        <input type="text" class="textfield" value="" id="wholText7" size="3" maxlength="1" name="wholText7" onkeypress="return is1to7(event)" /><br>

        <text id="wholLabel8" fill="red">8. The technique was fun to use:</text>
        <input type="text" class="textfield" value="" id="wholText8" size="3" maxlength="1" name="wholText8" onkeypress="return is1to7(event)" /><br>

        <text id="wholLabel9" fill="red">9. I would want to use this technique to select moving targets:</text>
        <input type="text" class="textfield" value="" id="wholText9" size="3" maxlength="1" name="wholText9" onkeypress="return is1to7(event)" /><br>

      </div>
      <br>
      <div id="acur">

        <text id="acurLabel" fill="red"><strong> Freeze Around Cursor </strong></text>
        <div id="acurValidate" class="validate" style="font-size: 150%; left: 10px; float: left;"></div><br>
        <br>
        <text id="acurLabel1" fill="red">1. The technique was difficult to use:</text>
        <input type="text" class="textfield" value="" id="acurText1" size="3" maxlength="1" name="acurText1" onkeypress="return is1to7(event)" /><br>

        <text id="acurLabel2" fill="red">2. The technique was easy to understand:</text>
        <input type="text" class="textfield" value="" id="acurText2" size="3" maxlength="1" name="acurText2" onkeypress="return is1to7(event)" /><br>

        <text id="acurLabel3" fill="red">3. The technique was easy to use:</text>
        <input type="text" class="textfield" value="" id="acurText3" size="3" maxlength="1" name="acurText3" onkeypress="return is1to7(event)" /><br>

        <text id="acurLabel4" fill="red">4. The technique was confusing or difficult to understand:</text>
        <input type="text" class="textfield" value="" id="acurText4" size="3" maxlength="1" name="acurText4" onkeypress="return is1to7(event)" /><br>

        <text id="acurLabel5" fill="red">5. The technique made it difficult to select the target I wanted:</text>
        <input type="text" class="textfield" value="" id="acurText5" size="3" maxlength="1" name="acurText5" onkeypress="return is1to7(event)" /><br>

        <text id="acurLabel6" fill="red">6. The technique made it easy to select the target I wanted:</text>
        <input type="text" class="textfield" value="" id="acurText6" size="3" maxlength="1" name="acurText6" onkeypress="return is1to7(event)" /><br>

        <text id="acurLabel7" fill="red">7. I did not like the technique:</text>
        <input type="text" class="textfield" value="" id="acurText7" size="3" maxlength="1" name="acurText7" onkeypress="return is1to7(event)" /><br>

        <text id="acurLabel8" fill="red">8. The technique was fun to use:</text>
        <input type="text" class="textfield" value="" id="acurText8" size="3" maxlength="1" name="acurText8" onkeypress="return is1to7(event)" /><br>

        <text id="acurLabel9" fill="red">9. I would want to use this technique to select moving targets:</text>
        <input type="text" class="textfield" value="" id="acurText9" size="3" maxlength="1" name="acurText9" onkeypress="return is1to7(event)" /><br>

      </div>
      <br>
      <div id="aclo">

        <text id="acolLabel" fill="red"><strong> Freeze Around Closest </strong></text>
        <div id="acolValidate" class="validate" style="font-size: 150%; left: 10px; float: left;"></div><br>
        <br>
        <text id="acloLabel1" fill="red">1. The technique was difficult to use:</text>
        <input type="text" class="textfield" value="" id="acloText1" size="3" maxlength="1" name="acloText1" onkeypress="return is1to7(event)" /><br>

        <text id="acloLabel2" fill="red">2. The technique was easy to understand:</text>
        <input type="text" class="textfield" value="" id="acloText2" size="3" maxlength="1" name="acloText2" onkeypress="return is1to7(event)" /><br>

        <text id="acloLabel3" fill="red">3. The technique was easy to use:</text>
        <input type="text" class="textfield" value="" id="acloText3" size="3" maxlength="1" name="acloText3" onkeypress="return is1to7(event)" /><br>

        <text id="acloLabel4" fill="red">4. The technique was confusing or difficult to understand:</text>
        <input type="text" class="textfield" value="" id="acloText4" size="3" maxlength="1" name="acloText4" onkeypress="return is1to7(event)" /><br>

        <text id="acloLabel5" fill="red">5. The technique made it difficult to select the target I wanted:</text>
        <input type="text" class="textfield" value="" id="acloText5" size="3" maxlength="1" name="acloText5" onkeypress="return is1to7(event)" /><br>

        <text id="acloLabel6" fill="red">6. The technique made it easy to select the target I wanted:</text>
        <input type="text" class="textfield" value="" id="acloText6" size="3" maxlength="1" name="acloText6" onkeypress="return is1to7(event)" /><br>

        <text id="acloLabel7" fill="red">7. I did not like the technique:</text>
        <input type="text" class="textfield" value="" id="acloText7" size="3" maxlength="1" name="acloText7" onkeypress="return is1to7(event)" /><br>

        <text id="acloLabel8" fill="red">8. The technique was fun to use:</text>
        <input type="text" class="textfield" value="" id="acloText8" size="3" maxlength="1" name="acloText8" onkeypress="return is1to7(event)" /><br>

        <text id="acloLabel9" fill="red">9. I would want to use this technique to select moving targets:</text>
        <input type="text" class="textfield" value="" id="acloText9" size="3" maxlength="1" name="acloText9" onkeypress="return is1to7(event)" /><br>

      </div>
      <br>
      <div id="traj">

        <text id="trajLabel" fill="red"><strong> Freeze Trajectory </strong></text>
        <div id="trajValidate" class="validate" style="font-size: 150%; left: 10px; float: left;"></div><br>
        <br>
        <text id="trajLabel1" fill="red">1. The technique was difficult to use:</text>
        <input type="text" class="textfield" value="" id="trajText1" size="3" maxlength="1" name="trajText1" onkeypress="return is1to7(event)" /><br>

        <text id="trajLabel2" fill="red">2. The technique was easy to understand:</text>
        <input type="text" class="textfield" value="" id="trajText2" size="3" maxlength="1" name="trajText2" onkeypress="return is1to7(event)" /><br>

        <text id="trajLabel3" fill="red">3. The technique was easy to use:</text>
        <input type="text" class="textfield" value="" id="trajText3" size="3" maxlength="1" name="trajText3" onkeypress="return is1to7(event)" /><br>

        <text id="trajLabel4" fill="red">4. The technique was confusing or difficult to understand:</text>
        <input type="text" class="textfield" value="" id="trajText4" size="3" maxlength="1" name="trajText4" onkeypress="return is1to7(event)" /><br>

        <text id="trajLabel5" fill="red">5. The technique made it difficult to select the target I wanted:</text>
        <input type="text" class="textfield" value="" id="trajText5" size="3" maxlength="1" name="trajText5" onkeypress="return is1to7(event)" /><br>

        <text id="trajLabel6" fill="red">6. The technique made it easy to select the target I wanted:</text>
        <input type="text" class="textfield" value="" id="trajText6" size="3" maxlength="1" name="trajText6" onkeypress="return is1to7(event)" /><br>

        <text id="trajLabel7" fill="red">7. I did not like the technique:</text>
        <input type="text" class="textfield" value="" id="trajText7" size="3" maxlength="1" name="trajText7" onkeypress="return is1to7(event)" /><br>

        <text id="trajLabel8" fill="red">8. The technique was fun to use:</text>
        <input type="text" class="textfield" value="" id="trajText8" size="3" maxlength="1" name="trajText8" onkeypress="return is1to7(event)" /><br>

        <text id="trajLabel9" fill="red">9. I would want to use this technique to select moving targets:</text>
        <input type="text" class="textfield" value="" id="trajText9" size="3" maxlength="1" name="trajText9" onkeypress="return is1to7(event)" /><br>

      </div>
      <br>
    </div>

    <h4>B ) Please rank the techniques in order of preference, starting with your favorite technique</h4>
    <div id="q2">
      <ul class="rank">
        <li> 1. </li>
        <li> 2. </li>
        <li> 3. </li>
        <li> 4. </li>
      </ul>

      <ul class="technique">
        <li>Whole Screen Freeze</li>
        <li>Freeze Around Cursor</li>
        <li>Freeze Around Closest</li>
        <li>Freeze Trajectory</li>
      </ul>

      <style>
        .technique, .rank {
          float: left;
        }

        .technique li, .rank li {
          list-style: none;
          background: #FFFFFF;
          padding: 2px;
          border: 1px solid #000000;
        }
      </style>

      <script>
        $(function() {
    			$('.technique').sortable();
    		});
      </script>
    </div>

    <div style="clear:both;"></div>

    <h4>C ) Which technique was your favorite?</h4>
    <div id="q3">
      <text id="favLabel" fill="red">Pick one of the following. </text>
      <div id="favValidate" class="validate" style="font-size: 150%; left: 10px; float: left;"></div>
      <div style="clear:both;"></div>
      <div id="favRadio">
          <input type="radio" id="f1" name="fav" value="Whole Screen Freeze"> Whole Screen Freeze <br>
          <input type="radio" id="f2" name="fav" value="Freeze Around Cursor"> Freeze Around Cursor <br>
          <input type="radio" id="f3" name="fav" value="Freeze Around Closest"> Freeze Around Closest <br>
          <input type="radio" id="f4" name="fav" value="Trajectory Freeze"> Trajectory Freeze <br>
      </div>
      <text id="favWhyLabel" fill="red">Please explain your why you chose this one. </text>
      <div id="favWhyValidate" class="validate" style="font-size: 150%; left: 10px; float: left;"></div>
      <textarea rows="6" cols="80" class="textfield" value="" id="favWhyText" size="125" name="favWhyText"></textarea>
    </div>

    <h4>D ) Which technique was your least favorite?</h4>
    <div id="q4">
      <text id="leastLabel" fill="red">Pick one of the following. </text>
      <div id="leastValidate" class="validate" style="font-size: 150%; left: 10px; float: left;"></div>
      <div style="clear:both;"></div>
      <div id="leastRadio">
          <input type="radio" id="l1" name="least" value="Whole Screen Freeze"> Whole Screen Freeze <br>
          <input type="radio" id="l2" name="least" value="Freeze Around Cursor"> Freeze Around Cursor <br>
          <input type="radio" id="l3" name="least" value="Freeze Around Closest"> Freeze Around Closest <br>
          <input type="radio" id="l4" name="least" value="Trajectory Freeze"> Trajectory Freeze <br>
      </div>
      <text id="leastWhyLabel" fill="red">Please explain your why you chose this one. </text>
      <div id="leastWhyValidate" class="validate" style="font-size: 150%; left: 10px; float: left;"></div>
      <textarea rows="6" cols="80" class="textfield" value="" id="leastWhyText" size="125" name="leastWhyText"></textarea>
    </div>

    <h4>E ) Do you have any other feedback about why you liked or disliked any particular technique?</h4>
    <div id="q5">
      <text id="feedback1Label" fill="red">If none fill as 'N/A'. </text>
      <div id="feedback1Validate" class="validate" style="font-size: 150%; left: 10px; float: left;"></div>
      <br>
      <textarea rows="6" cols="80" class="textfield" value="" id="feedback1Text" size="125" name="feedback1Text"></textarea>
    </div>

    <h4>F ) Do you have any other feedback about the study?</h4>
    <div id="q6">
      <text id="feedback2Label" fill="red">If none fill as 'N/A'. </text>
      <div id="feedback2Validate" class="validate" style="font-size: 150%; left: 10px; float: left;"></div>
      <br>
      <textarea rows="6" cols="80" class="textfield" value="" id="feedback2Text" size="125" name="feedback2Text"></textarea>
    </div>

  <br>
  <button id="submitComments" class="next-button" type="button">Next</button>
  <div id="validateMessage" class="validate"></div>
  <br>
</div>
<script>

  function is1to7(evt) {
    evt = (evt) ? evt : window.event;
    var charCode = (evt.which) ? evt.which : evt.keyCode;
    if (charCode > 48 && charCode < 56) {
        return true;
    }
    return false;
  }

  function arrayHasNull(arr) {
    for (i = 0; i < arr.length; i++) {
      var x = parseInt(arr[i]);
      if (isNaN(x)) {
        return true;
      }
    }
    return false;
  }

  (function() {
    var data = {};

    experimentr.hideNext();

    experimentr.startTimer('closing_survey');

    //Question A
    var wholText = [];
    for (i = 1; i < 10; i++) {
      wholText[i - 1] = d3.select('#wholText' + i);
    }

    var acurText = [];
    for (i = 1; i < 10; i++) {
      acurText[i - 1] = d3.select('#acurText' + i);
    }

    var acloText = [];
    for (i = 1; i < 10; i++) {
      acloText[i - 1] = d3.select('#acloText' + i);
    }

    var trajText = [];
    for (i = 1; i < 10; i++) {
      trajText[i - 1] = d3.select('#trajText' + i);
    }

    //Question C
    var favRadio = d3.select('#favRadio');
    var favWhyText = d3.select('#favWhyText');

    //Question D
    var leastRadio = d3.select('#leastRadio');
    var leastWhyText = d3.select('#leastWhyText');

    //Question E
    var feedback1Text = d3.select('#feedback1Text');

    //Question F
    var feedback2Text = d3.select('#feedback2Text');

    d3.selectAll('input')
      .filter(function(d) { return this.name === 'fav' ? this : null; })
      .on('change', function() { data.fav = this.value; });

    d3.selectAll('input')
      .filter(function(d) { return this.name === 'least' ? this : null; })
      .on('change', function() { data.least = this.value; });

    function goToNext() {
      experimentr.endTimer('closing_survey');
      experimentr.addData(data);
      //experimentr.release();
      experimentr.next();
    }

    function validate() {

      //Question A
      data.whol = [];
      for (i = 1; i < 10; i++) {
        data.whol[i - 1] = wholText[i - 1].property('value');
      }

      data.acur = [];
      for (i = 1; i < 10; i++) {
        data.acur[i - 1] = acurText[i - 1].property('value');
      }

      data.aclo = [];
      for (i = 1; i < 10; i++) {
        data.aclo[i - 1] = acloText[i - 1].property('value');
      }

      data.traj = [];
      for (i = 1; i < 10; i++) {
        data.traj[i - 1] = trajText[i - 1].property('value');
      }

      //Question B
      data.techList = [];
      var techniqueList = d3.select(".technique").selectAll("li");
      techniqueList = techniqueList[0];
      for (i = 0; i < 4; i++) {
        data.techList[i] = techniqueList[i].textContent;
      }

      //Question C
      data.favWhy = favWhyText.property('value');

      //Question D
      data.leastWhy = leastWhyText.property('value');

      //Question E
      data.feedback1 = feedback1Text.property('value');

      //Question F
      data.feedback2 = feedback2Text.property('value');

      var messageThing = d3.select('#validateMessage');
      var messageText = "";
      messageThing.html("");

      if (!arrayHasNull(data.whol)) {
        d3.select('#wholValidate').text("");
      } else {
        d3.select('#wholValidate').text("* ");
        messageText += "<p>* Missing answers in Whole Screen Freeze section.</p>"
      }

      if (!arrayHasNull(data.acur)) {
        d3.select('#acurValidate').text("");
      } else {
        d3.select('#acurValidate').text("* ");
        messageText += "<p>* Missing answers in Freeze Around Cursor section.</p>"
      }

      if (!arrayHasNull(data.aclo)) {
        d3.select('#acloValidate').text("");
      } else {
        d3.select('#acloValidate').text("* ");
        messageText += "<p>* Missing answers in Freeze Around Closest section.</p>"
      }

      if (!arrayHasNull(data.traj)) {
        d3.select('#trajValidate').text("");
      } else {
        d3.select('#trajValidate').text("* ");
        messageText += "<p>* Missing answers in Trajectory Freeze section.</p>"
      }

      if (data.fav) {
        d3.select('#favValidate').text("");
      } else {
        d3.select('#favValidate').text("* ");
        messageText += "<p>* Pick a favorite.</p>"
      }

      if (data.favWhy) {
        d3.select('#favWhyValidate').text("");
      } else {
        d3.select('#favWhyValidate').text("* ");
        messageText += "<p>* Please give a reason for your favorite.</p>"
      }

      if (data.least) {
        d3.select('#leastValidate').text("");
      } else {
        d3.select('#leastValidate').text("* ");
        messageText += "<p>* Pick a least favorite.</p>"
      }

      if (data.leastWhy) {
        d3.select('#leastWhyValidate').text("");
      } else {
        d3.select('#leastWhyValidate').text("* ");
        messageText += "<p>* Please give a reason for your least favorite.</p>"
      }

      if (data.feedback1) {
        d3.select('#feedback1Validate').text("");
      } else {
        d3.select('#feedback1Validate').text("* ");
        messageText += "<p>* Please provide a response to question E.</p>"
      }

      if (data.feedback2) {
        d3.select('#feedback2Validate').text("");
        console.log(data.feedback2);
      } else {
        d3.select('#feedback2Validate').text("* ");
        messageText += "<p>* Please provide a response to question F.</p>"
      }

      if(data.whol && data.acur && data.aclo && data.techList && data.favWhy && data.fav && data.leastWhy && data.least && data.feedback1 && data.feedback2) {
        //d3.select('#submitComments').attr('disabled', null);
        goToNext();
      } else {
        messageThing.html(messageText);
      }
    }//end validate

    d3.select('#submitComments')
      .on('click', function () {
        validate();
      });
  }());

</script>
